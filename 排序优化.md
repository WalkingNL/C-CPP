## 排序优化
本文将依托排序谈谈优化，所以不止涉及排序本身的优化，还涉及一些统筹的规划。个人认为，后者更为关键。因为如果说前者创造了美，后者则决定美应置于何处，以致更美，美不胜收。

本文的安排如下：
  * 你真的掌握排序了吗
  * 优化前的预处理
  * 性能取舍

### 你真的掌握排序了？
首先说明，这个标题并不是要复杂化排序，只是作为强调而用。在多[《维视角看排序》](https://github.com/WalkingNL/C-CPP/blob/master/%E5%A4%9A%E7%BB%B4%E8%A7%86%E8%A7%92%E7%9C%8B%E6%8E%92%E5%BA%8F.md)里面，谈及了视角这个概念，这篇文章，同样从视角出发，重新梳理排序。多年前，从那篇[《快排为什么那样快》](http://mindhacks.cn/2008/06/13/why-is-quicksort-so-quick/)的文章里，感受到同样的问题，不同的视角去审视，内心的共鸣会完全不同，最终引发的结果就是不同思考方式。而好的文章，必定具备这个特点。

在这篇文章里，作者也不止说明了快排的快，也解释了快排的慢，以及慢的原因。所以不妨在本文中，我们就从这个角度切入。首先假设有下面的一个序列，为了排除一些非必要的干扰，确定序列中无重复的元素。随机选择一个轴元素，就记作pivot。从第一个元素开始，依次与pivot进行比较。那么A1大于或小于pivot的概率为1/2，这个都没问题，这里就假定`A1>pivot`，接下来，`A2>pivot`的概率是多少呢，答案是2/3。

    A1 A2 ... Ai ... An
如果你也看了作者的文章，会不会在这个问题上懵一下呢？懵的原因更多是对快排理解的不够彻底。还是先看看作者给出的证明吧。
> 证明：如果A2<pivot的话，那么A1，A2，pivot这三个元素之间的关系就完全确定了，即A1>pivot>A2，剩下来的元素排列的可能性我们不妨记为P（不需要具体算出来）。而如果A2>pivot的话？那么A1和A2的关系就仍然是不确定的，也就是说包含两种情况：A1>A2>pivot，以及A2>A1>pivot。对于其中任一种情况，剩下的元素排列的可能性也同样是P，于是这个分支里面剩下的排列可能性就是2P。因此当A2>pivot的时候，还剩下2/3的**可能性需要排查**

可以看出`2/3`本质上并不是指`A2>pivot`的概率，而是序列的可能性。



在这篇文章里，作者沿着概率的方向慢慢引导出快排之所以快的原因，核心在于每一次的排序完成之后，都能为后续元素将可能解的空间收缩一半。这句话如何理解呢？我们更为直观的解释这个问题，看下面序列，一共9个数字。未排序前，共有`9!`种重排列(如果是N个数字，就是N!)。我们选取第一个元素，即`1`作为`pivot`。第一次排完序之后，仅仅确定好了第一个位置，注意，虽然表面上序列无任何变化，但实际上，第一个位置从不确定变成了确定。那么还剩余`8!`种重排列，解空间大小减少了1/9。

    1, 6, 3, 7, 9, 5, 8, 2, 4
如果不选第一个元素为pivot，而选取第6个元素，即`5`作为pivot，进行第一次排序之后，序列变成如下。可以看到，`5`在序列的最中间，剩余`2 * 4!`种排列，解空间大小减少

    1, 3, 4, 2, 5, 6, 8, 7, 9


### 优化前的预处理

### 性能取舍

